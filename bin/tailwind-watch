#!/bin/bash

echo "==============================================="
echo "ğŸ¨ Iniciando Tailwind CSS Watch Mode..."
echo "==============================================="

# Build inicial
echo "ğŸ“¦ Fazendo build inicial do CSS..."
bundle exec rails tailwindcss:build

if [ $? -eq 0 ]; then
    echo "âœ… Build inicial concluÃ­do com sucesso!"
else
    echo "âŒ Erro no build inicial!"
    exit 1
fi

echo "ğŸ‘€ Monitorando mudanÃ§as nos arquivos..."
echo "   - app/views/**/*.html.erb"
echo "   - app/helpers/**/*.rb"
echo "   - app/components/**/*.rb"
echo "   - app/assets/stylesheets/**/*.css"

# Loop para rebuild quando detectar mudanÃ§as
while true; do
    # Aguarda por mudanÃ§as nos arquivos relevantes
    inotifywait -e modify,create,delete,move \
        -r app/views/ app/helpers/ app/components/ app/assets/stylesheets/ \
        --format '%w%f %e' 2>/dev/null
    
    if [ $? -eq 0 ]; then
        echo "ğŸ”„ Arquivos modificados! Reconstruindo CSS..."
        bundle exec rails tailwindcss:build
        
        if [ $? -eq 0 ]; then
            echo "âœ… CSS reconstruÃ­do com sucesso! $(date '+%H:%M:%S')"
        else
            echo "âŒ Erro ao reconstruir CSS! $(date '+%H:%M:%S')"
        fi
    fi
    
    # Pequena pausa para evitar builds muito frequentes
    sleep 1
done